<!DOCTYPE html>
<html lang="en">
{{> head }}

<body>
    {{> sidebar }}
    <main>
        {{> header }}
        <section class="mt-[68px] p-4 overflow-x-scroll">
            <div class="flex justify-between items-center space-x-4 pb-8">
                <h1 class="font-bold text-lg">Categories</h1>
                <a href="/categories/create">
                    <button type="submit"
                        class=" text-green-500 inline-flex items-center hover:text-white border border-green-500 hover:bg-green-500 focus:ring-4 focus:outline-none focus:ring-green-500 font-semibold rounded-lg text-sm px-5 py-2.5 text-center ">
                        Create New Category
                    </button>
                </a>
            </div>
            <table id="categories-table" class="w-full">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Parent</th>
                        <th>Active</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody class="categories-table-body"></tbody>
            </table>
        </section>
        {{> footer }}

        <dialog id="dialog"
            class="w-[400px] h-[250px] bg-blue-950 absolute top-0 left-0 right-0 bottom-0 m-auto rounded-lg">
            <h3 class="w-full text-center mt-8 font-bold text-white">Are you sure you want to delete this?</h3>
            <button id="cancelBtn" onclick="closeModal()"
                class="float-right bg-white rounded-lg mr-4 px-4 py-2 mt-[100px]">Cancel</button>
            <button id="confirmBtn" onclick="remove()"
                class="float-right bg-white rounded-lg mr-4 px-4 py-2 mt-[100px]">Confirm</button>
        </dialog>
    </main>

    <script>
        const categories = {{ json categories }}
        const removeUrl = {{ json removeUrl }}

        const dialog = document.getElementById('dialog');
        let id = ''

        $(document).ready(async () => {
            const categoriesBody = $('.categories-table-body');
            categories?.forEach((category) => {
                categoriesBody.append(`
                        <tr>
                            <td>${category?.id}</td>
                            <td>${category?.name}</td>
                            <td>${category?.parent?.name || 'none'}</td>
                            <td>${category?.active}</td>
                            <td class='flex gap-8'>
                                <a href='/categories/${category?.id}'><button><i class="fa-solid fa-pen-to-square" style="color: #43fa00;"></i></button></a>
                                <button onclick="showModal(event)" value="${category?.id}"><i class="fa-solid fa-xmark" style="color: #f08000;"></i></button>
                                <button><i class="fa-solid fa-trash" style="color: #fd1c1c;"></i></button>
                            </td>
                        </tr>
                    `)
            })
            $('#categories-table').DataTable({
                pageLength: 5,
                lengthMenu: [5, 10, 25, 50],
            });
        });

        const showModal = (event) => {
            id = event.currentTarget.value
            dialog.showModal()
        }
        const closeModal = () => {
            dialog.close()
        }

        const remove = async () => {
            const accessToken = localStorage.getItem('access_token')
            console.log(id)
            try {
                const res = await fetch(`${removeUrl}/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${accessToken}`
                    },
                    credentials: 'include'
                })
                const data = await res.json()
                toast(data)
            } catch (e) {
                console.log(e)
            }
            closeModal()
        }
    </script>
    {{> common }}
</body>

</html>