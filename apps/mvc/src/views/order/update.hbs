<!DOCTYPE html>
<html lang="en">
{{> head }}

<body>
    {{> sidebar }}
    <main>
        {{> header }}
        <section class="mt-[68px] p-4">
            <h1 class="font-bold text-lg pb-8">Approve Customer Order</h1>
            <form action="/" method="PATCH" onsubmit="update()">
                <div class="grid gap-4 mb-4 sm:grid-cols-2 sm:gap-6 sm:mb-5">
                    {{!-- TOTAL --}}
                    <div>
                        <label for="total" class="block mb-2 text-sm font-medium text-gray-900">Total Price</label>
                        <input type="text" id="total" disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            value={{ json order.total }} required="">
                    </div>
                    {{!-- CUSTOMER ID --}}
                    <div>
                        <label for="customer" class="block mb-2 text-sm font-medium text-gray-900">Customer ID</label>
                        <input type="text" id="customer" disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            value={{ json order.user_id }} required="">
                    </div>
                    {{!-- NAME --}}
                    <div>
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900">Name</label>
                        <input type="text" id="name" disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            value={{ json order.name }} required="">
                    </div>
                    {{!-- PHONE --}}
                    <div>
                        <label for="phone" class="block mb-2 text-sm font-medium text-gray-900">Phone</label>
                        <input type="text" id="phone" disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            value={{ json order.phone }} required="">
                    </div>
                    {{!-- EMAIL --}}
                    <div>
                        <label for="email" class="block mb-2 text-sm font-medium text-gray-900">Email</label>
                        <input type="text" id="email" disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            value={{ json order.email }} required="">
                    </div>
                    {{!-- ADDRESS --}}
                    <div>
                        <label for="address" class="block mb-2 text-sm font-medium text-gray-900">Address</label>
                        <input type="text" id="address" disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            value={{ json order.address }} required="">
                    </div>
                    {{!-- PAYMENT METHOD --}}
                    <div>
                        <label for="payment_method" class="block mb-2 text-sm font-medium text-gray-900">Payment
                            Method</label>
                        <input type="text" id="payment_method" disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            value={{ json order.payment_method }} required="">
                    </div>
                    {{!-- PAYMENT STATUS --}}
                    <div>
                        <label for="payment-status" class="block mb-2 text-sm font-medium text-gray-900 ">Payment
                            Status</label>
                        <select id="payment-status" name="payment_status" value={{ json order.payment_status }}
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5  dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500">
                            <option value="PAID" id="PAID" class="payment-status">PAID</option>
                            <option value="UNPAID" id="UNPAID" class="payment-status">UNPAID</option>
                        </select>
                    </div>
                    {{!-- ORDER STATUS --}}
                    <div>
                        <label for="order-status" class="block mb-2 text-sm font-medium text-gray-900 ">Order
                            Status</label>
                        <select id="order-status" name="status" value={{ json order.status }}
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5  dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-primary-500 dark:focus:border-primary-500">
                            <option value="PENDING" id="PENDING" class="order-status">PENDING</option>
                            <option value="CONFIRMED" id="CONFIRMED" class="order-status">CONFIRMED</option>
                            <option value="SHIPPING" id="SHIPPING" class="order-status">SHIPPING</option>
                            <option value="COMPLETED" id="COMPLETED" class="order-status">COMPLETED</option>
                        </select>
                    </div>
                    {{!-- ORDER ITEMS --}}
                    <div class="sm:col-span-2">
                        <label for="items" class="block mb-2 text-sm font-medium text-gray-900">Order Items</label>
                        <ul id="items" class="space-y-4 text-left text-gray-500 dark:text-gray-400">
                            {{#each items}}
                            <li class="flex items-center space-x-3 rtl:space-x-reverse">
                                <svg class="flex-shrink-0 w-3.5 h-3.5 text-green-500 dark:text-green-400"
                                    aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 16 12">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                        stroke-width="2" d="M1 5.917 5.724 10.5 15 1.5" />
                                </svg>
                                <span>Product ID: {{this.product_id}}, quantity: {{this.quantity}}</span>
                            </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button type="submit"
                        class=" text-green-500 inline-flex items-center hover:text-white border border-green-500 hover:bg-green-500 focus:ring-4 focus:outline-none focus:ring-green-500 font-semibold rounded-lg text-sm px-5 py-2.5 text-center ">
                        Update
                    </button>
                </div>
            </form>
        </section>
        {{> footer }}
    </main>


    <script>
        const order = {{ json order }}
        const updateUrl = {{ json updateUrl }}

        const orderStatus = document.querySelector('#order-status')
        const orderStatusArr = document.querySelectorAll('.order-status')
        for (let item of orderStatusArr) {
            if (item.value == order.status) {
                orderStatus.value = item.value
            }
        }

        const paymentStatus = document.querySelector('#payment-status')
        const paymentStatusArr = document.querySelectorAll('.payment-status')
        for (let item of paymentStatusArr) {
            if (item.value == order.payment_status) {
                paymentStatus.value = item.value
            }
        }
        if (order?.payment_status == "PAID") {
            paymentStatus.disabled = true
            paymentStatus.value = "PAID"
        }

        const update = async () => {
            event.preventDefault()
            const formData = new FormData(event.target);
            const body = Object.fromEntries(formData);

            const accessToken = localStorage.getItem('access_token')
            try {
                const res = await fetch(updateUrl, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${accessToken}`
                    },
                    body: JSON.stringify(body),
                    credentials: 'include'
                })
                const data = await res.json()
                toast(data)
            } catch (e) {
                console.log(e)
            }
        }
    </script>
    {{> common }}
</body>

</html>